<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Êï∏ÊìöËß£Á¢ºÁ´ô v1.0</title>
<style>
:root {
  --morandi-pink: #D4A5A5;
  --morandi-pink-light: #E8B4B8;
  --morandi-pink-dark: #C9A0A0;
  --morandi-gray: #D5C4C4;
  --morandi-beige: #E8DDD0;
  --morandi-blue: #A8B5C4;
  --text-primary: #6B5B5B;
  --text-secondary: #9B8B8B;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
  background: linear-gradient(135deg, var(--morandi-beige) 0%, var(--morandi-gray) 100%);
  min-height: 100vh;
  padding: 20px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

/* ÊöóÈªëÊ®°Âºè */
body.dark-mode {
  --morandi-pink: #8B7373;
  --morandi-pink-light: #A08888;
  --morandi-pink-dark: #766363;
  --morandi-gray: #7A6F6F;
  --morandi-beige: #6B6560;
  --morandi-blue: #6D7580;
  --text-primary: #D5C4C4;
  --text-secondary: #B5A8A8;
  background: linear-gradient(135deg, #4A4540 0%, #5A4F4F 100%);
}

.container {
  max-width: 900px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.header {
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  text-align: center;
  position: relative;
}

body.dark-mode .header {
  background: rgba(0, 0, 0, 0.3);
}

.header-icon {
  font-size: 48px;
  margin-bottom: 12px;
}

.header-title {
  font-size: 28px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  margin-bottom: 8px;
}

.header-subtitle {
  font-size: 14px;
  color: var(--text-secondary);
}

.theme-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--morandi-pink-light);
  border: none;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  transform: scale(1.1);
}

.back-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--morandi-pink-light);
  border: none;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
}

.back-btn:hover {
  transform: scale(1.1);
}

.section {
  background: rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

body.dark-mode .section {
  background: rgba(0, 0, 0, 0.25);
}

.section-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.textarea-input {
  width: 100%;
  min-height: 300px;
  padding: 16px;
  border: 2px solid var(--morandi-pink-light);
  border-radius: 12px;
  font-size: 14px;
  font-family: "Courier New", monospace;
  background: rgba(255, 255, 255, 0.8);
  color: var(--text-primary);
  resize: vertical;
  transition: all 0.3s;
}

body.dark-mode .textarea-input {
  background: rgba(0, 0, 0, 0.3);
  border-color: var(--morandi-pink);
}

.textarea-input:focus {
  outline: none;
  border-color: var(--morandi-pink);
  box-shadow: 0 0 0 4px rgba(212, 165, 165, 0.1);
}

.unit-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
}

.unit-btn {
  padding: 16px 12px;
  border: 2px solid var(--morandi-pink-light);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.8);
  color: var(--text-primary);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
}

body.dark-mode .unit-btn {
  background: rgba(0, 0, 0, 0.3);
  border-color: var(--morandi-pink);
}

.unit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(212, 165, 165, 0.3);
}

.unit-btn.selected {
  background: var(--morandi-pink);
  color: white;
  border-color: var(--morandi-pink);
}

.result-display {
  background: rgba(255, 255, 255, 0.9);
  border: 2px dashed var(--morandi-pink-light);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  min-height: 200px;
}

body.dark-mode .result-display {
  background: rgba(0, 0, 0, 0.4);
  border-color: var(--morandi-pink);
}

.result-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-top: 12px;
}

.result-item {
  text-align: center;
  padding: 16px;
  background: var(--morandi-beige);
  border-radius: 10px;
}

body.dark-mode .result-item {
  background: rgba(0, 0, 0, 0.3);
}

.result-label {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 8px;
  font-weight: 600;
}

.result-row {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.result-number {
  font-size: 24px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  background: rgba(255, 255, 255, 0.8);
  padding: 8px 12px;
  border-radius: 8px;
  min-width: 40px;
}

body.dark-mode .result-number {
  background: rgba(0, 0, 0, 0.4);
  color: var(--morandi-pink-light);
}

.number-input {
  font-size: 24px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  background: rgba(255, 255, 255, 0.8);
  padding: 8px 12px;
  border-radius: 8px;
  min-width: 50px;
  width: 60px;
  border: 2px solid var(--morandi-pink-light);
  text-align: center;
  transition: all 0.3s;
}

.number-input:focus {
  outline: none;
  border-color: var(--morandi-pink);
  box-shadow: 0 0 0 4px rgba(212, 165, 165, 0.2);
  background: rgba(255, 255, 255, 1);
}

body.dark-mode .number-input {
  background: rgba(0, 0, 0, 0.4);
  color: var(--morandi-pink-light);
  border-color: var(--morandi-pink);
}

body.dark-mode .number-input:focus {
  background: rgba(0, 0, 0, 0.6);
  box-shadow: 0 0 0 4px rgba(212, 165, 165, 0.1);
}

/* Hide number input spinners */
.number-input::-webkit-inner-spin-button,
.number-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.number-input {
  -moz-appearance: textfield;
}

.rank-label {
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: 4px;
}

.btn-primary {
  width: 100%;
  padding: 16px;
  background: var(--morandi-pink);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(212, 165, 165, 0.3);
}

.btn-primary:hover {
  background: var(--morandi-pink-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(212, 165, 165, 0.4);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-secondary {
  width: 100%;
  padding: 16px;
  background: var(--morandi-blue);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(168, 181, 196, 0.3);
  margin-top: 12px;
}

.btn-secondary:hover {
  background: #8FA0B0;
  transform: translateY(-2px);
}

.hint-text {
  font-size: 13px;
  color: var(--text-secondary);
  text-align: center;
  margin-top: 12px;
  line-height: 1.6;
}

.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

/* iOS È¢®Ê†ºÈ†êË¶ΩÂΩàÁ™ó */
.ios-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  z-index: 10000;
  animation: fadeIn 0.2s ease;
}

.ios-modal {
  background: white;
  border-radius: 20px 20px 0 0;
  width: 100%;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  padding: 24px;
  animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

body.dark-mode .ios-modal {
  background: rgba(30, 20, 15, 0.95);
  backdrop-filter: blur(20px);
}

.ios-modal-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  margin-bottom: 16px;
  text-align: center;
}

body.dark-mode .ios-modal-title {
  color: var(--morandi-pink-light);
}

.ios-modal-content {
  background: var(--morandi-beige);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  white-space: pre-wrap;
  font-family: "Courier New", monospace;
  font-size: 14px;
  line-height: 1.8;
  color: var(--text-primary);
}

body.dark-mode .ios-modal-content {
  background: rgba(0, 0, 0, 0.3);
  color: var(--text-primary);
}

.ios-modal-actions {
  display: flex;
  gap: 12px;
}

.ios-modal-btn {
  flex: 1;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.ios-modal-btn-primary {
  background: var(--morandi-pink);
  color: white;
}

.ios-modal-btn-secondary {
  background: var(--morandi-blue);
  color: white;
}

.ios-modal-btn:active {
  transform: scale(0.95);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

@media (max-width: 600px) {
  .unit-grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .result-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<a href="index.html" class="back-btn">üè†</a>
<button onclick="toggleTheme()" class="theme-toggle" id="themeToggle">üåô</button>

<div class="container">
  <div class="header">
    <div class="header-icon">üì°</div>
    <div class="header-title">Êï∏ÊìöËß£Á¢ºÁ´ô</div>
    <div class="header-subtitle">Data Decoder ¬∑ Intel Parser</div>
  </div>

  <!-- Ê≠•È©ü1ÔºöË≤º‰∏äË≥áÊñô -->
  <div class="section">
    <div class="section-title">
      <span>üìã</span>
      <span>Ê≠•È©ü 1ÔºöË≤º‰∏äË≥áÊñô</span>
    </div>
    <textarea
      class="textarea-input"
      id="inputData"
      placeholder="Ë´ãÂ∞áÂèÉËÄÉ.txtÁöÑÂÖßÂÆπË≤º‰∏äÂà∞ÈÄôË£°...&#10;&#10;‰æãÂ¶ÇÔºö&#10;‚ö†Ô∏èÂêÑÂñÆ‰ΩçÊñº1600ÂâçÂõûÂ†±ËøîÈáë„ÄÅÂ≥∂‰ºë„ÄÅÂèóË®ì‰∫∫Âì°ÔºåË´ãË®ªË®òÔºàÂÆòÔºåÂ£´ÔºåÂÖµÔºâ&#10;&#10;Êà∞Ôºö&#10;ËøîÈáëÔºà0Ôºå1Ôºå0Ôºâ&#10;Â≥∂‰ºëÔºà0Ôºå3Ôºå1Ôºâ&#10;ÂèóË®ìÔºà1Ôºå5Ôºå5Ôºâ&#10;&#10;Á†≤Ôºö&#10;ËøîÈáëÔºà0Ôºå0Ôºå1Ôºâ&#10;Â≥∂‰ºëÔºà0Ôºå0Ôºå0Ôºâ&#10;ÂèóË®ìÔºà2Ôºå0Ôºå1Ôºâ"
    ></textarea>
    <button class="btn-primary" onclick="parseData()">üîç Ëß£ÊûêË≥áÊñô</button>
  </div>

  <!-- Ê≠•È©ü2ÔºöÈÅ∏ÊìáÂñÆ‰Ωç -->
  <div class="section" id="unitSection" style="display: none;">
    <div class="section-title">
      <span>üéØ</span>
      <span>Ê≠•È©ü 2ÔºöÈÅ∏ÊìáÂñÆ‰Ωç</span>
    </div>
    <div class="unit-grid" id="unitGrid"></div>
  </div>

  <!-- Ê≠•È©ü3ÔºöÈ°ØÁ§∫ÁµêÊûú -->
  <div class="section" id="resultSection" style="display: none;">
    <div class="section-title">
      <span>‚ú®</span>
      <span>Ëß£ÊûêÁµêÊûú</span>
    </div>
    <div class="result-display" id="resultDisplay">
      <div class="empty-state">
        <div class="empty-icon">üìä</div>
        <div>Ëß£ÊûêÁµêÊûúÂ∞áÈ°ØÁ§∫Âú®ÈÄôË£°</div>
      </div>
    </div>
    <button class="btn-primary" onclick="previewResult()">üìã È†êË¶ΩÁµêÊûú</button>
  </div>
</div>

<script>
let parsedData = {};
let selectedUnit = null;
let originalInput = '';
let unitOrder = [];

// Ëß£ÊûêË≥áÊñô
function parseData() {
  const input = document.getElementById('inputData').value;
  if (!input.trim()) {
    alert('‚ùå Ë´ãÂÖàË≤º‰∏äË≥áÊñô');
    return;
  }

  // ‰øùÂ≠òÂéüÂßãËº∏ÂÖ•
  originalInput = input;
  parsedData = {};
  unitOrder = [];
  const lines = input.split('\n');
  let currentUnit = null;

  for (let line of lines) {
    line = line.trim();

    // Ëá™ÂãïÊ™¢Ê∏¨ÂñÆ‰ΩçÔºà‰ªª‰Ωï„ÄåXXXÔºö„ÄçÊ†ºÂºèÔºâ
    const unitMatch = line.match(/^(.+?)[Ôºö:]\s*$/);
    if (unitMatch) {
      currentUnit = unitMatch[1].trim();
      unitOrder.push(currentUnit);
      parsedData[currentUnit] = {
        ËøîÈáë: null,
        Â≥∂‰ºë: null,
        ÂèóË®ì: null
      };
      continue;
    }

    // Ëß£ÊûêÊï∏Êìö
    if (currentUnit) {
      const match = line.match(/(ËøîÈáë|Â≥∂‰ºë|ÂèóË®ì)\s*[Ôºà(](\d+)[Ôºå,]\s*(\d+)[Ôºå,]\s*(\d+)[)Ôºâ]/);
      if (match) {
        const type = match[1];
        const officer = match[2];
        const nco = match[3];
        const soldier = match[4];
        parsedData[currentUnit][type] = { officer, nco, soldier };
      }
    }
  }

  // È°ØÁ§∫ÂèØÈÅ∏ÂñÆ‰Ωç
  displayUnits();
}

// È°ØÁ§∫ÂñÆ‰ΩçÈÅ∏Êìá
function displayUnits() {
  const unitGrid = document.getElementById('unitGrid');
  unitGrid.innerHTML = '';

  const availableUnits = Object.keys(parsedData);

  if (availableUnits.length === 0) {
    alert('‚ùå Êú™ÊâæÂà∞ÂñÆ‰Ωç\nË´ãÊ™¢Êü•Ë≥áÊñôÊ†ºÂºèÔºàÈúÄË¶ÅÊúâ„ÄåÂñÆ‰ΩçÔºö„ÄçÊ®ôË®òÔºâ');
    return;
  }

  availableUnits.forEach(unit => {
    const data = parsedData[unit];
    const hasData = data.ËøîÈáë || data.Â≥∂‰ºë || data.ÂèóË®ì;

    const btn = document.createElement('button');
    btn.className = 'unit-btn';
    btn.dataset.unit = unit; // ÂÑ≤Â≠òÂñÆ‰ΩçÂêçÁ®±
    btn.innerHTML = `${unit}${hasData ? '' : '<br><span style="font-size:11px;opacity:0.6;">(ÁÑ°Ë≥áÊñô)</span>'}`;
    btn.onclick = () => selectUnit(unit);
    unitGrid.appendChild(btn);
  });

  document.getElementById('unitSection').style.display = 'block';
}

// ÈÅ∏ÊìáÂñÆ‰Ωç
function selectUnit(unit) {
  selectedUnit = unit;

  // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖãÔºà‰ΩøÁî® data-unit Â±¨ÊÄßÊØîÂ∞çÔºâ
  document.querySelectorAll('.unit-btn').forEach(btn => {
    btn.classList.toggle('selected', btn.dataset.unit === unit);
  });

  // È°ØÁ§∫ÁµêÊûú
  displayResult();
}

// È°ØÁ§∫ÁµêÊûú
function displayResult() {
  if (!selectedUnit) return;

  const data = parsedData[selectedUnit];
  const resultDisplay = document.getElementById('resultDisplay');

  // Ëá™ÂãïÂà§Êñ∑Ê®°ÂºèÔºöÊúâ‰ªª‰ΩïÊï∏Êìö=ÊõøÊèõÔºåÂÆåÂÖ®Ê≤íÊï∏Êìö=ÊèíÂÖ•
  const hasAnyData = data.ËøîÈáë || data.Â≥∂‰ºë || data.ÂèóË®ì;
  const mode = hasAnyData ? 'ÊõøÊèõÊ®°Âºè' : 'ÊèíÂÖ•Ê®°Âºè';
  const modeColor = hasAnyData ? '#D4A5A5' : '#A8B5C4';

  resultDisplay.innerHTML = `
    <div style="text-align: center; margin-bottom: 20px;">
      <div style="font-size: 20px; font-weight: 700; color: var(--morandi-pink-dark);">
        ${selectedUnit} ÂñÆ‰Ωç
      </div>
      <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">
        <span style="background: ${modeColor}; color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">
          ${mode}
        </span>
      </div>
    </div>
    <div class="result-grid">
      ${['ËøîÈáë', 'Â≥∂‰ºë', 'ÂèóË®ì'].map(type => {
        const item = data[type];
        const officer = item ? item.officer : '0';
        const nco = item ? item.nco : '0';
        const soldier = item ? item.soldier : '0';

        return `
          <div class="result-item">
            <div class="result-label">${type}</div>
            <div class="result-row">
              <input type="number" class="number-input" id="input-${type}-officer" value="${officer}" min="0" max="999" onfocus="this.select()">
              <input type="number" class="number-input" id="input-${type}-nco" value="${nco}" min="0" max="999" onfocus="this.select()">
              <input type="number" class="number-input" id="input-${type}-soldier" value="${soldier}" min="0" max="999" onfocus="this.select()">
            </div>
            <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
              <div class="rank-label">ÂÆò</div>
              <div class="rank-label">Â£´</div>
              <div class="rank-label">ÂÖµ</div>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;

  document.getElementById('resultSection').style.display = 'block';
}

// ÁîüÊàêÁµêÊûúÊñáÂ≠óÔºà‰øùÁïôÂéüÂßãÊñáÊú¨ÔºåÂè™ÊõøÊèõÈÅ∏‰∏≠ÂñÆ‰ΩçÔºâ
function generateResultText() {
  if (!selectedUnit) return '';

  // ÂæûËº∏ÂÖ•Ê°ÜËÆÄÂèñÁî®Êà∂Á∑®ËºØÁöÑÊï∏Êìö
  const editedLines = [];
  ['ËøîÈáë', 'Â≥∂‰ºë', 'ÂèóË®ì'].forEach(type => {
    const officerInput = document.getElementById(`input-${type}-officer`);
    const ncoInput = document.getElementById(`input-${type}-nco`);
    const soldierInput = document.getElementById(`input-${type}-soldier`);

    if (officerInput && ncoInput && soldierInput) {
      const officer = officerInput.value || '0';
      const nco = ncoInput.value || '0';
      const soldier = soldierInput.value || '0';
      editedLines.push(`${type}Ôºà${officer}Ôºå${nco}Ôºå${soldier}Ôºâ`);
    }
  });

  const newDataText = editedLines.join('\n');

  // Ê™¢Êü•Ë©≤ÂñÆ‰ΩçÂéüÊú¨ÊúâÊ≤íÊúâÊï∏Êìö
  const unitData = parsedData[selectedUnit];
  const hasOriginalData = unitData.ËøîÈáë || unitData.Â≥∂‰ºë || unitData.ÂèóË®ì;

  let result = originalInput;

  if (hasOriginalData) {
    // ÊúâÊï∏ÊìöÔºöÊõøÊèõÁèæÊúâÊï∏Êìö
    // ÂåπÈÖçË©≤ÂñÆ‰ΩçÂçÄÂ°äÔºöÂñÆ‰ΩçÂêçÁ®± + ÂæåÁ∫åÁöÑÊï∏ÊìöË°å
    const unitPattern = new RegExp(
      `(${escapeRegExp(selectedUnit)}[Ôºö:]\s*\n)([\\s\\S]*?)(?=\n\n|$)`,
      'g'
    );

    result = result.replace(unitPattern, (match, unitLine, dataBlock) => {
      return unitLine + newDataText;
    });
  } else {
    // ÁÑ°Êï∏ÊìöÔºöÊèíÂÖ•Êñ∞Êï∏Êìö
    // ÊâæÂà∞ÂñÆ‰ΩçÂêçÁ®±ÈÇ£‰∏ÄË°åÔºåÂú®ÂæåÈù¢ÊèíÂÖ•Êï∏Êìö
    const unitLinePattern = new RegExp(
      `(${escapeRegExp(selectedUnit)}[Ôºö:]\s*\n)`,
      'g'
    );

    result = result.replace(unitLinePattern, (match) => {
      return match + newDataText + '\n';
    });
  }

  return result;
}

// ËºîÂä©ÂáΩÊï∏ÔºöËΩâÁæ©Ê≠£ÂâáË°®ÈÅîÂºèÁâπÊÆäÂ≠óÁ¨¶
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// È†êË¶ΩÁµêÊûú
function previewResult() {
  if (!selectedUnit) {
    alert('‚ùå Ë´ãÂÖàÈÅ∏ÊìáÂñÆ‰Ωç');
    return;
  }

  const text = generateResultText();
  showIOSPreview('üì° Êï∏ÊìöËß£ÊûêÁµêÊûú', text);
}

// iOS È¢®Ê†ºÈ†êË¶ΩÂΩàÁ™ó
function showIOSPreview(title, content) {
  // ÁßªÈô§ÁèæÊúâÁöÑÂΩàÁ™ó
  const existing = document.querySelector('.ios-modal-overlay');
  if (existing) existing.remove();

  // ÂâµÂª∫Êñ∞ÂΩàÁ™ó
  const overlay = document.createElement('div');
  overlay.className = 'ios-modal-overlay';
  overlay.onclick = (e) => {
    if (e.target === overlay) closeIOSPreview();
  };

  const modal = document.createElement('div');
  modal.className = 'ios-modal';

  modal.innerHTML = `
    <div class="ios-modal-title">${title}</div>
    <div class="ios-modal-content">${content}</div>
    <div class="ios-modal-actions">
      <button class="ios-modal-btn ios-modal-btn-primary" onclick="copyToClipboard(\`${content.replace(/`/g, '\\`')}\`)">
        üìã Ë§áË£Ω
      </button>
      <button class="ios-modal-btn ios-modal-btn-secondary" onclick="shareToLINE(\`${content.replace(/`/g, '\\`')}\`)">
        üí¨ ÂàÜ‰∫´Âà∞ LINE
      </button>
    </div>
  `;

  overlay.appendChild(modal);
  document.body.appendChild(overlay);
}

// ÈóúÈñâÈ†êË¶Ω
function closeIOSPreview() {
  const overlay = document.querySelector('.ios-modal-overlay');
  if (overlay) {
    overlay.style.animation = 'fadeOut 0.2s ease';
    setTimeout(() => overlay.remove(), 200);
  }
}

// Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('‚úÖ Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
    closeIOSPreview();
  }).catch(() => {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    alert('‚úÖ Â∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
    closeIOSPreview();
  });
}

// ÂàÜ‰∫´Âà∞ LINE
function shareToLINE(text) {
  const url = `line://msg/text/${encodeURIComponent(text)}`;
  window.location.href = url;
}

// ‰∏ªÈ°åÂàáÊèõ
function toggleTheme() {
  const body = document.body;
  const themeToggle = document.getElementById('themeToggle');
  const isDark = body.classList.toggle('dark-mode');

  themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('parser_theme', isDark ? 'dark' : 'light');
}

// ËºâÂÖ•‰∏ªÈ°å
function loadTheme() {
  const savedTheme = localStorage.getItem('parser_theme');
  const themeToggle = document.getElementById('themeToggle');
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  const isDark = savedTheme === 'dark' || (savedTheme === null && prefersDark);

  if (isDark) {
    document.body.classList.add('dark-mode');
    if (themeToggle) themeToggle.textContent = '‚òÄÔ∏è';
  }
}

// ÂàùÂßãÂåñ
window.addEventListener('load', () => {
  loadTheme();
});
</script>

</body>
</html>
