<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ•¸æ“šè§£ç¢¼ç«™ v1.0</title>
<style>
:root {
  --morandi-pink: #D4A5A5;
  --morandi-pink-light: #E8B4B8;
  --morandi-pink-dark: #C9A0A0;
  --morandi-gray: #D5C4C4;
  --morandi-beige: #E8DDD0;
  --morandi-blue: #A8B5C4;
  --text-primary: #6B5B5B;
  --text-secondary: #9B8B8B;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif;
  background: linear-gradient(135deg, var(--morandi-beige) 0%, var(--morandi-gray) 100%);
  min-height: 100vh;
  padding: 20px;
  color: var(--text-primary);
  transition: all 0.3s ease;
}

/* æš—é»‘æ¨¡å¼ */
body.dark-mode {
  --morandi-pink: #8B7373;
  --morandi-pink-light: #A08888;
  --morandi-pink-dark: #766363;
  --morandi-gray: #7A6F6F;
  --morandi-beige: #6B6560;
  --morandi-blue: #6D7580;
  --text-primary: #D5C4C4;
  --text-secondary: #B5A8A8;
  background: linear-gradient(135deg, #4A4540 0%, #5A4F4F 100%);
}

.container {
  max-width: 900px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.header {
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  text-align: center;
  position: relative;
}

body.dark-mode .header {
  background: rgba(0, 0, 0, 0.3);
}

.header-icon {
  font-size: 48px;
  margin-bottom: 12px;
}

.header-title {
  font-size: 28px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  margin-bottom: 8px;
}

.header-subtitle {
  font-size: 14px;
  color: var(--text-secondary);
}

.theme-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--morandi-pink-light);
  border: none;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  transform: scale(1.1);
}

.back-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: var(--morandi-pink-light);
  border: none;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;
}

.back-btn:hover {
  transform: scale(1.1);
}

.section {
  background: rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
}

body.dark-mode .section {
  background: rgba(0, 0, 0, 0.25);
}

.section-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.textarea-input {
  width: 100%;
  min-height: 300px;
  padding: 16px;
  border: 2px solid var(--morandi-pink-light);
  border-radius: 12px;
  font-size: 14px;
  font-family: "Courier New", monospace;
  background: rgba(255, 255, 255, 0.8);
  color: var(--text-primary);
  resize: vertical;
  transition: all 0.3s;
}

body.dark-mode .textarea-input {
  background: rgba(0, 0, 0, 0.3);
  border-color: var(--morandi-pink);
}

.textarea-input:focus {
  outline: none;
  border-color: var(--morandi-pink);
  box-shadow: 0 0 0 4px rgba(212, 165, 165, 0.1);
}

.unit-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
}

.unit-btn {
  padding: 16px 12px;
  border: 2px solid var(--morandi-pink-light);
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.8);
  color: var(--text-primary);
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  text-align: center;
}

body.dark-mode .unit-btn {
  background: rgba(0, 0, 0, 0.3);
  border-color: var(--morandi-pink);
}

.unit-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(212, 165, 165, 0.3);
}

.unit-btn.selected {
  background: var(--morandi-pink);
  color: white;
  border-color: var(--morandi-pink);
}

.result-display {
  background: rgba(255, 255, 255, 0.9);
  border: 2px dashed var(--morandi-pink-light);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  min-height: 200px;
}

body.dark-mode .result-display {
  background: rgba(0, 0, 0, 0.4);
  border-color: var(--morandi-pink);
}

.result-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-top: 12px;
}

.result-item {
  text-align: center;
  padding: 16px;
  background: var(--morandi-beige);
  border-radius: 10px;
}

body.dark-mode .result-item {
  background: rgba(0, 0, 0, 0.3);
}

.result-label {
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 8px;
  font-weight: 600;
}

.result-row {
  display: flex;
  gap: 8px;
  justify-content: center;
}

.result-number {
  font-size: 24px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  background: rgba(255, 255, 255, 0.8);
  padding: 8px 12px;
  border-radius: 8px;
  min-width: 40px;
}

body.dark-mode .result-number {
  background: rgba(0, 0, 0, 0.4);
  color: var(--morandi-pink-light);
}

.number-input {
  font-size: 24px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  background: rgba(255, 255, 255, 0.8);
  padding: 8px 12px;
  border-radius: 8px;
  min-width: 50px;
  width: 60px;
  border: 2px solid var(--morandi-pink-light);
  text-align: center;
  transition: all 0.3s;
}

.number-input:focus {
  outline: none;
  border-color: var(--morandi-pink);
  box-shadow: 0 0 0 4px rgba(212, 165, 165, 0.2);
  background: rgba(255, 255, 255, 1);
}

body.dark-mode .number-input {
  background: rgba(0, 0, 0, 0.4);
  color: var(--morandi-pink-light);
  border-color: var(--morandi-pink);
}

body.dark-mode .number-input:focus {
  background: rgba(0, 0, 0, 0.6);
  box-shadow: 0 0 0 4px rgba(212, 165, 165, 0.1);
}

/* Hide number input spinners */
.number-input::-webkit-inner-spin-button,
.number-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.number-input {
  -moz-appearance: textfield;
}

.rank-label {
  font-size: 11px;
  color: var(--text-secondary);
  margin-top: 4px;
}

.btn-primary {
  width: 100%;
  padding: 16px;
  background: var(--morandi-pink);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(212, 165, 165, 0.3);
}

.btn-primary:hover {
  background: var(--morandi-pink-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(212, 165, 165, 0.4);
}

.btn-primary:active {
  transform: translateY(0);
}

.btn-secondary {
  width: 100%;
  padding: 16px;
  background: var(--morandi-blue);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(168, 181, 196, 0.3);
  margin-top: 12px;
}

.btn-secondary:hover {
  background: #8FA0B0;
  transform: translateY(-2px);
}

.hint-text {
  font-size: 13px;
  color: var(--text-secondary);
  text-align: center;
  margin-top: 12px;
  line-height: 1.6;
}

.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-secondary);
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

/* iOS é¢¨æ ¼é è¦½å½ˆçª— */
.ios-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  z-index: 10000;
  animation: fadeIn 0.2s ease;
}

.ios-modal {
  background: white;
  border-radius: 20px 20px 0 0;
  width: 100%;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  padding: 24px;
  animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

body.dark-mode .ios-modal {
  background: rgba(30, 20, 15, 0.95);
  backdrop-filter: blur(20px);
}

.ios-modal-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--morandi-pink-dark);
  margin-bottom: 16px;
  text-align: center;
}

body.dark-mode .ios-modal-title {
  color: var(--morandi-pink-light);
}

.ios-modal-content {
  background: var(--morandi-beige);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  white-space: pre-wrap;
  font-family: "Courier New", monospace;
  font-size: 14px;
  line-height: 1.8;
  color: var(--text-primary);
}

body.dark-mode .ios-modal-content {
  background: rgba(0, 0, 0, 0.3);
  color: var(--text-primary);
}

.ios-modal-actions {
  display: flex;
  gap: 12px;
}

.ios-modal-btn {
  flex: 1;
  padding: 14px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.ios-modal-btn-primary {
  background: var(--morandi-pink);
  color: white;
}

.ios-modal-btn-secondary {
  background: var(--morandi-blue);
  color: white;
}

.ios-modal-btn:active {
  transform: scale(0.95);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

@media (max-width: 600px) {
  .unit-grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .result-grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>

<a href="index.html" class="back-btn">ğŸ </a>
<button onclick="toggleTheme()" class="theme-toggle" id="themeToggle">ğŸŒ™</button>

<div class="container">
  <div class="header">
    <div class="header-icon">ğŸ“¡</div>
    <div class="header-title">æ•¸æ“šè§£ç¢¼ç«™</div>
    <div class="header-subtitle">Data Decoder Â· Intel Parser</div>
  </div>

  <!-- æ­¥é©Ÿ1ï¼šè²¼ä¸Šè³‡æ–™ -->
  <div class="section">
    <div class="section-title">
      <span>ğŸ“‹</span>
      <span>æ­¥é©Ÿ 1ï¼šè²¼ä¸Šè³‡æ–™</span>
    </div>
    <textarea
      class="textarea-input"
      id="inputData"
      placeholder="è«‹å°‡åƒè€ƒ.txtçš„å…§å®¹è²¼ä¸Šåˆ°é€™è£¡...&#10;&#10;ä¾‹å¦‚ï¼š&#10;âš ï¸å„å–®ä½æ–¼1600å‰å›å ±è¿”é‡‘ã€å³¶ä¼‘ã€å—è¨“äººå“¡ï¼Œè«‹è¨»è¨˜ï¼ˆå®˜ï¼Œå£«ï¼Œå…µï¼‰&#10;&#10;æˆ°ï¼š&#10;è¿”é‡‘ï¼ˆ0ï¼Œ1ï¼Œ0ï¼‰&#10;å³¶ä¼‘ï¼ˆ0ï¼Œ3ï¼Œ1ï¼‰&#10;å—è¨“ï¼ˆ1ï¼Œ5ï¼Œ5ï¼‰&#10;&#10;ç ²ï¼š&#10;è¿”é‡‘ï¼ˆ0ï¼Œ0ï¼Œ1ï¼‰&#10;å³¶ä¼‘ï¼ˆ0ï¼Œ0ï¼Œ0ï¼‰&#10;å—è¨“ï¼ˆ2ï¼Œ0ï¼Œ1ï¼‰"
    ></textarea>
    <button class="btn-primary" onclick="parseData()">ğŸ” è§£æè³‡æ–™</button>
  </div>

  <!-- æ­¥é©Ÿ2ï¼šé¸æ“‡å–®ä½ -->
  <div class="section" id="unitSection" style="display: none;">
    <div class="section-title">
      <span>ğŸ¯</span>
      <span>æ­¥é©Ÿ 2ï¼šé¸æ“‡å–®ä½</span>
    </div>
    <div class="unit-grid" id="unitGrid"></div>
  </div>

  <!-- æ­¥é©Ÿ3ï¼šé¡¯ç¤ºçµæœ -->
  <div class="section" id="resultSection" style="display: none;">
    <div class="section-title">
      <span>âœ¨</span>
      <span>è§£æçµæœ</span>
    </div>
    <div class="result-display" id="resultDisplay">
      <div class="empty-state">
        <div class="empty-icon">ğŸ“Š</div>
        <div>è§£æçµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡</div>
      </div>
    </div>
    <button class="btn-primary" onclick="previewResult()">ğŸ“‹ é è¦½çµæœ</button>
  </div>
</div>

<script>
let parsedData = {};
let selectedUnit = null;
let originalInput = '';
let unitOrder = [];

// è§£æè³‡æ–™
function parseData() {
  const input = document.getElementById('inputData').value;
  if (!input.trim()) {
    alert('âŒ è«‹å…ˆè²¼ä¸Šè³‡æ–™');
    return;
  }

  // ä¿å­˜åŸå§‹è¼¸å…¥
  originalInput = input;
  parsedData = {};
  unitOrder = [];
  const lines = input.split('\n');
  let currentUnit = null;

  for (let line of lines) {
    line = line.trim();

    // è‡ªå‹•æª¢æ¸¬å–®ä½ï¼ˆä»»ä½•ã€ŒXXXï¼šã€æ ¼å¼ï¼‰
    const unitMatch = line.match(/^(.+?)[ï¼š:]\s*$/);
    if (unitMatch) {
      currentUnit = unitMatch[1].trim();
      unitOrder.push(currentUnit);
      parsedData[currentUnit] = {
        è¿”é‡‘: null,
        å³¶ä¼‘: null,
        å—è¨“: null
      };
      continue;
    }

    // è§£ææ•¸æ“š
    if (currentUnit) {
      const match = line.match(/(è¿”é‡‘|å³¶ä¼‘|å—è¨“)\s*[ï¼ˆ(](\d+)[ï¼Œ,]\s*(\d+)[ï¼Œ,]\s*(\d+)[)ï¼‰]/);
      if (match) {
        const type = match[1];
        const officer = match[2];
        const nco = match[3];
        const soldier = match[4];
        parsedData[currentUnit][type] = { officer, nco, soldier };
      }
    }
  }

  // é¡¯ç¤ºå¯é¸å–®ä½
  displayUnits();
}

// é¡¯ç¤ºå–®ä½é¸æ“‡
function displayUnits() {
  const unitGrid = document.getElementById('unitGrid');
  unitGrid.innerHTML = '';

  const availableUnits = Object.keys(parsedData);

  if (availableUnits.length === 0) {
    alert('âŒ æœªæ‰¾åˆ°å–®ä½\nè«‹æª¢æŸ¥è³‡æ–™æ ¼å¼ï¼ˆéœ€è¦æœ‰ã€Œå–®ä½ï¼šã€æ¨™è¨˜ï¼‰');
    return;
  }

  availableUnits.forEach(unit => {
    const data = parsedData[unit];
    const hasData = data.è¿”é‡‘ || data.å³¶ä¼‘ || data.å—è¨“;

    const btn = document.createElement('button');
    btn.className = 'unit-btn';
    btn.dataset.unit = unit; // å„²å­˜å–®ä½åç¨±
    btn.innerHTML = `${unit}${hasData ? '' : '<br><span style="font-size:11px;opacity:0.6;">(ç„¡è³‡æ–™)</span>'}`;
    btn.onclick = () => selectUnit(unit);
    unitGrid.appendChild(btn);
  });

  document.getElementById('unitSection').style.display = 'block';
}

// é¸æ“‡å–®ä½
function selectUnit(unit) {
  selectedUnit = unit;

  // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆä½¿ç”¨ data-unit å±¬æ€§æ¯”å°ï¼‰
  document.querySelectorAll('.unit-btn').forEach(btn => {
    btn.classList.toggle('selected', btn.dataset.unit === unit);
  });

  // é¡¯ç¤ºçµæœ
  displayResult();
}

// é¡¯ç¤ºçµæœ
function displayResult() {
  if (!selectedUnit) return;

  const data = parsedData[selectedUnit];
  const resultDisplay = document.getElementById('resultDisplay');

  // è‡ªå‹•åˆ¤æ–·æ¨¡å¼ï¼šæœ‰ä»»ä½•æ•¸æ“š=æ›¿æ›ï¼Œå®Œå…¨æ²’æ•¸æ“š=æ’å…¥
  const hasAnyData = data.è¿”é‡‘ || data.å³¶ä¼‘ || data.å—è¨“;
  const mode = hasAnyData ? 'æ›¿æ›æ¨¡å¼' : 'æ’å…¥æ¨¡å¼';
  const modeColor = hasAnyData ? '#D4A5A5' : '#A8B5C4';

  resultDisplay.innerHTML = `
    <div style="text-align: center; margin-bottom: 20px;">
      <div style="font-size: 20px; font-weight: 700; color: var(--morandi-pink-dark);">
        ${selectedUnit} å–®ä½
      </div>
      <div style="font-size: 13px; color: var(--text-secondary); margin-top: 4px;">
        <span style="background: ${modeColor}; color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">
          ${mode}
        </span>
      </div>
    </div>
    <div class="result-grid">
      ${['è¿”é‡‘', 'å³¶ä¼‘', 'å—è¨“'].map(type => {
        const item = data[type];
        const officer = item ? item.officer : '0';
        const nco = item ? item.nco : '0';
        const soldier = item ? item.soldier : '0';

        return `
          <div class="result-item">
            <div class="result-label">${type}</div>
            <div class="result-row">
              <input type="number" class="number-input" id="input-${type}-officer" value="${officer}" min="0" max="999" onfocus="this.select()">
              <input type="number" class="number-input" id="input-${type}-nco" value="${nco}" min="0" max="999" onfocus="this.select()">
              <input type="number" class="number-input" id="input-${type}-soldier" value="${soldier}" min="0" max="999" onfocus="this.select()">
            </div>
            <div style="display: flex; gap: 8px; justify-content: center; margin-top: 8px;">
              <div class="rank-label">å®˜</div>
              <div class="rank-label">å£«</div>
              <div class="rank-label">å…µ</div>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;

  document.getElementById('resultSection').style.display = 'block';
}

// ç”Ÿæˆçµæœæ–‡å­—ï¼ˆä¿ç•™åŸå§‹æ–‡æœ¬ï¼Œåªæ›¿æ›é¸ä¸­å–®ä½ï¼‰
function generateResultText() {
  if (!selectedUnit) return '';

  // å¾è¼¸å…¥æ¡†è®€å–ç”¨æˆ¶ç·¨è¼¯çš„æ•¸æ“š
  const editedLines = [];
  ['è¿”é‡‘', 'å³¶ä¼‘', 'å—è¨“'].forEach(type => {
    const officerInput = document.getElementById(`input-${type}-officer`);
    const ncoInput = document.getElementById(`input-${type}-nco`);
    const soldierInput = document.getElementById(`input-${type}-soldier`);

    if (officerInput && ncoInput && soldierInput) {
      const officer = officerInput.value || '0';
      const nco = ncoInput.value || '0';
      const soldier = soldierInput.value || '0';
      editedLines.push(`${type}ï¼ˆ${officer}ï¼Œ${nco}ï¼Œ${soldier}ï¼‰`);
    }
  });

  const newDataText = editedLines.join('\n');

  // æª¢æŸ¥è©²å–®ä½åŸæœ¬æœ‰æ²’æœ‰æ•¸æ“š
  const unitData = parsedData[selectedUnit];
  const hasOriginalData = unitData.è¿”é‡‘ || unitData.å³¶ä¼‘ || unitData.å—è¨“;

  let result = originalInput;

  if (hasOriginalData) {
    // æœ‰æ•¸æ“šï¼šæ›¿æ›ç¾æœ‰æ•¸æ“š
    // åŒ¹é…è©²å–®ä½å€å¡Šï¼šå–®ä½åç¨± + å¾ŒçºŒçš„æ•¸æ“šè¡Œ
    const unitPattern = new RegExp(
      `(${escapeRegExp(selectedUnit)}[ï¼š:]\s*\n)([\\s\\S]*?)(?=\n\n|$)`,
      'g'
    );

    result = result.replace(unitPattern, (match, unitLine, dataBlock) => {
      return unitLine + newDataText;
    });
  } else {
    // ç„¡æ•¸æ“šï¼šæ’å…¥æ–°æ•¸æ“š
    // æ‰¾åˆ°å–®ä½åç¨±é‚£ä¸€è¡Œï¼Œåœ¨å¾Œé¢æ’å…¥æ•¸æ“š
    const unitLinePattern = new RegExp(
      `(${escapeRegExp(selectedUnit)}[ï¼š:]\s*\n)`,
      'g'
    );

    result = result.replace(unitLinePattern, (match) => {
      return match + newDataText + '\n';
    });
  }

  return result;
}

// è¼”åŠ©å‡½æ•¸ï¼šè½‰ç¾©æ­£å‰‡è¡¨é”å¼ç‰¹æ®Šå­—ç¬¦
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// é è¦½çµæœ
function previewResult() {
  if (!selectedUnit) {
    alert('âŒ è«‹å…ˆé¸æ“‡å–®ä½');
    return;
  }

  const text = generateResultText();
  showIOSPreview('ğŸ“¡ æ•¸æ“šè§£æçµæœ', text);
}

// iOS é¢¨æ ¼é è¦½å½ˆçª—
function showIOSPreview(title, content) {
  // ç§»é™¤ç¾æœ‰çš„å½ˆçª—
  const existing = document.querySelector('.ios-modal-overlay');
  if (existing) existing.remove();

  // å‰µå»ºæ–°å½ˆçª—
  const overlay = document.createElement('div');
  overlay.className = 'ios-modal-overlay';
  overlay.onclick = (e) => {
    if (e.target === overlay) closeIOSPreview();
  };

  const modal = document.createElement('div');
  modal.className = 'ios-modal';

  modal.innerHTML = `
    <div class="ios-modal-title">${title}</div>
    <div class="ios-modal-content">${content}</div>
    <div class="ios-modal-actions">
      <button class="ios-modal-btn ios-modal-btn-primary" onclick="copyToClipboard(\`${content.replace(/`/g, '\\`')}\`)">
        ğŸ“‹ è¤‡è£½
      </button>
      <button class="ios-modal-btn ios-modal-btn-secondary" onclick="shareToLINE(\`${content.replace(/`/g, '\\`')}\`)">
        ğŸ’¬ åˆ†äº«åˆ° LINE
      </button>
    </div>
  `;

  overlay.appendChild(modal);
  document.body.appendChild(overlay);
}

// é—œé–‰é è¦½
function closeIOSPreview() {
  const overlay = document.querySelector('.ios-modal-overlay');
  if (overlay) {
    overlay.style.animation = 'fadeOut 0.2s ease';
    setTimeout(() => overlay.remove(), 200);
  }
}

// è¤‡è£½åˆ°å‰ªè²¼ç°¿
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
    closeIOSPreview();
  }).catch(() => {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    alert('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
    closeIOSPreview();
  });
}

// åˆ†äº«åˆ° LINE
function shareToLINE(text) {
  const url = `line://msg/text/${encodeURIComponent(text)}`;
  window.location.href = url;
}

// ä¸»é¡Œåˆ‡æ›
function toggleTheme() {
  const body = document.body;
  const themeToggle = document.getElementById('themeToggle');
  const isDark = body.classList.toggle('dark-mode');

  themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
  localStorage.setItem('parser_theme', isDark ? 'dark' : 'light');
}

// è¼‰å…¥ä¸»é¡Œ
function loadTheme() {
  const savedTheme = localStorage.getItem('parser_theme');
  const themeToggle = document.getElementById('themeToggle');
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  const isDark = savedTheme === 'dark' || (savedTheme === null && prefersDark);

  if (isDark) {
    document.body.classList.add('dark-mode');
    if (themeToggle) themeToggle.textContent = 'â˜€ï¸';
  }
}

// åˆå§‹åŒ–
window.addEventListener('load', () => {
  loadTheme();
});
</script>

</body>
</html>
